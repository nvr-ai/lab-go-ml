#!/usr/bin/env bash

git clone --recursive https://github.com/microsoft/onnxruntime --depth 1

./build.sh --config Release \
  --parallel \
  --compile_no_warning_as_error \
  --skip_submodule_sync \
  --osx_arch "arm64" \
  --use_coreml \
  --build_wheel \
  --wheel_name_suffix="-silicon" \
  --skip_tests

mkdir -p ../third_party
cp build/MacOS/Release/libonnxruntime.1.23.0.dylib ../third_party/onnxruntime.dylib

rm -rf onnxruntime
